<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QBank - ë°©ì†¡ëŒ€ ê¸°ì¶œ ë¬¸ì œ ì€í–‰</title>
    <style>
        :root { --primary: #4285F4; --admin: #db4437; }
        body { font-family: 'ë§‘ì€ ê³ ë”•', sans-serif; margin: 0; background: #f5f5f5; }
        header { background: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 8px; }
        .quiz-card { border-bottom: 1px solid #eee; padding: 15px 0; }
        .admin-section { display: none; background: #fff3f3; border: 1px solid var(--admin); padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .admin-authorized .admin-section { display: block; }
        button { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        #loginBtn { background: var(--primary); color: white; }
    </style>
</head>
<body>

<header>
    <h2>ğŸ“š QBank ê¸°ì¶œë¬¸ì œ</h2>
    <div>
        <span id="userInfo">ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”</span>
        <button id="loginBtn" onclick="handleLogin()">ë¡œê·¸ì¸</button>
    </div>
</header>

<div class="container">
    <div class="admin-section">
        <h4 style="color: var(--admin); margin-top: 0;">âš™ï¸ ê´€ë¦¬ì ëª¨ë“œ (ë¯¼ì£¼ë‹˜ ì „ìš©)</h4>
        <p>íŒŒì´ì¬ í”„ë¡œê·¸ë¨ì—ì„œ ì¶”ì¶œí•œ ë°ì´í„°ê°€ ì•„ë˜ ëª©ë¡ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
    </div>

    <div id="quiz-list">
        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCNnZltTeWoOodD7zmonx34RivTz6i8s04",
        authDomain: "qbank-f4821.firebaseapp.com",
        databaseURL: "https://qbank-f4821-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "qbank-f4821"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const provider = new GoogleAuthProvider();

    // 1. ë¡œê·¸ì¸ ë¡œì§
    window.handleLogin = async () => {
        if (auth.currentUser) {
            await signOut(auth);
            location.reload();
        } else {
            try {
                await signInWithPopup(auth, provider);
            } catch (e) { alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message); }
        }
    };

    // 2. ë°ì´í„° ì‹¤ì‹œê°„ ë¡œë“œ
    const quizListDiv = document.getElementById('quiz-list');
    onValue(ref(db, 'quizzes'), (snapshot) => {
        const data = snapshot.val();
        if (!data) {
            quizListDiv.innerHTML = "<p>ë“±ë¡ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì´ì¬ ë„êµ¬ë¡œ ì¶”ì¶œí•´ ë³´ì„¸ìš”!</p>";
            return;
        }
        
        // ë°ì´í„° í™”ë©´ ì¶œë ¥ (ê³¼ëª©ë³„ ë°˜ë³µ)
        let html = "";
        for (let subject in data) {
            html += `<h3>ğŸ“˜ ${subject}</h3>`;
            for (let year in data[subject]) {
                for (let type in data[subject][year]) {
                    const questions = data[subject][year][type];
                    html += `<p><strong>${year}ë…„ ${type}</strong> (${questions.length}ë¬¸ì œ)</p>`;
                }
            }
        }
        quizListDiv.innerHTML = html;
    });

    // 3. ê¶Œí•œ ì²´í¬
    onAuthStateChanged(auth, (user) => {
        const btn = document.getElementById('loginBtn');
        const info = document.getElementById('userInfo');
        if (user) {
            info.innerText = user.displayName + "ë‹˜ ";
            btn.innerText = "ë¡œê·¸ì•„ì›ƒ";
            if (user.email === "minjukang727@gmail.com") {
                document.body.classList.add('admin-authorized');
            }
        }
    });
</script>
</body>
</html>