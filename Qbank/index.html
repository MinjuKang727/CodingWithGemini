<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QBank - ë°©ì†¡ëŒ€ ê¸°ì¶œ ë¬¸ì œ ì€í–‰</title>
    <style>
        :root { --primary: #4285F4; --admin: #db4437; }
        body { font-family: 'ë§‘ì€ ê³ ë”•', sans-serif; margin: 0; background: #f5f5f5; }
        header { background: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 8px; }
        .quiz-card { border-bottom: 1px solid #eee; padding: 15px 0; }
        .admin-section { display: none; background: #fff3f3; border: 1px solid var(--admin); padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .admin-authorized .admin-section { display: block; }
        button { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        #loginBtn { background: var(--primary); color: white; }
    </style>
</head>
<body>

<header>
    <h2>ğŸ“š QBank ê¸°ì¶œë¬¸ì œ</h2>
    <div>
        <span id="userInfo">ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”</span>
        <button id="loginBtn" onclick="handleLogin()">ë¡œê·¸ì¸</button>
    </div>
</header>

<div class="container">
    <div class="admin-section">
        <h4 style="color: var(--admin); margin-top: 0;">âš™ï¸ ê´€ë¦¬ì ëª¨ë“œ (ë¯¼ì£¼ë‹˜ ì „ìš©)</h4>
        <p>íŒŒì´ì¬ í”„ë¡œê·¸ë¨ì—ì„œ ì¶”ì¶œí•œ ë°ì´í„°ê°€ ì•„ë˜ ëª©ë¡ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
    </div>

    <div id="quiz-list">
        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithRedirect, getRedirectResult, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCNnZltTeWoOodD7zmonx34RivTz6i8s04",
        authDomain: "qbank-f4821.firebaseapp.com",
        databaseURL: "https://qbank-f4821-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "qbank-f4821"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const provider = new GoogleAuthProvider();

    // ë¡œê·¸ì¸ ì‹œë„ (ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì‹ - íŒì—… ì°¨ë‹¨ ìš°íšŒ)
    window.handleLogin = () => {
        if (auth.currentUser) {
            signOut(auth).then(() => location.reload());
        } else {
            signInWithRedirect(auth, provider);
        }
    };

    // ë¦¬ë‹¤ì´ë ‰íŠ¸ í›„ ê²°ê³¼ ì²˜ë¦¬
    getRedirectResult(auth).catch((error) => {
        if(error.code !== 'auth/none') console.error("ì¸ì¦ ì—ëŸ¬:", error.message);
    });

    // ë°ì´í„° ë¡œë“œ (ê·œì¹™ì„ trueë¡œ ë°”ê¿¨ë‹¤ë©´ ë°”ë¡œ ì‹¤í–‰ë¨)
    onValue(ref(db, '/'), (snapshot) => {
        const data = snapshot.val();
        const quizListDiv = document.getElementById('quiz-list');
        
        if (!data) {
            quizListDiv.innerHTML = "<p>ë“±ë¡ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
        }
        
        let html = "";
        // ë°ì´í„°ë² ì´ìŠ¤ ìµœìƒìœ„ì˜ ê° í•­ëª©(ê³¼ëª©ëª…)ì„ ë°˜ë³µí•©ë‹ˆë‹¤.
        for (let subject in data) {
            // Firebaseê°€ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ë©”íƒ€ë°ì´í„° ë“±ì€ ì œì™¸í•˜ê³  ê³¼ëª© ë°ì´í„°ë§Œ ì²˜ë¦¬
            if (typeof data[subject] === 'object' && data[subject] !== null) {
                html += `<div style="border:1px solid #ddd; padding:15px; margin-bottom:15px; border-radius:8px; background:#fff;">`;
                html += `<h3 style="color:#4285F4; margin-top:0;">ğŸ“˜ ${subject}</h3>`;
                
                for (let year in data[subject]) {
                    for (let type in data[subject][year]) {
                        html += `<button onclick="startQuiz('${subject}', '${year}', '${type}')" 
                                style="margin:5px; padding:8px 12px; background:#f0f0f0; border:1px solid #ccc; border-radius:4px; cursor:pointer;">
                                ${year}ë…„ ${type}
                                </button> `;
                    }
                }
                html += `</div>`;
            }
        }
        quizListDiv.innerHTML = html;
    });

    onAuthStateChanged(auth, (user) => {
        const btn = document.getElementById('loginBtn');
        const info = document.getElementById('userInfo');
        if (user) {
            info.innerText = user.displayName + "ë‹˜ ë°˜ê°‘ìŠµë‹ˆë‹¤. ";
            btn.innerText = "ë¡œê·¸ì•„ì›ƒ";
            if (user.email === "minjukang727@gmail.com") document.body.classList.add('admin-authorized');
        }
    });
</script>
</body>
</html>