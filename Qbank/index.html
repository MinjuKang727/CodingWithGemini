<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QBank - ê¸°ì¶œ ë¬¸ì œ ì€í–‰</title>
    <style>
        body { font-family: 'ë§‘ì€ ê³ ë”•', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .subject-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .subject-title { color: #1a73e8; font-size: 1.5rem; margin-top: 0; border-bottom: 2px solid #e8f0fe; padding-bottom: 10px; }
        .year-section { margin-top: 15px; padding-left: 10px; border-left: 3px solid #4285f4; }
        .quiz-btn { 
            background: #fff; border: 1px solid #dadce0; padding: 10px 15px; margin: 5px; 
            border-radius: 20px; cursor: pointer; transition: all 0.2s; font-size: 0.9rem;
        }
        .quiz-btn:hover { background: #e8f0fe; border-color: #4285f4; color: #1967d2; }
        #userInfo { margin-bottom: 20px; text-align: right; font-size: 0.9rem; color: #5f6368; }
        #loginBtn { background: #1a73e8; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div id="userInfo">
        <span id="userText">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</span>
        <button id="loginBtn" onclick="handleLogin()">ë¡œê·¸ì¸</button>
    </div>

    <h1>ğŸ“š ë‚˜ì˜ ë¬¸ì œ ì€í–‰</h1>
    <div id="quiz-list">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithRedirect, getRedirectResult, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCNnZltTeWoOodD7zmonx34RivTz6i8s04",
        authDomain: "qbank-f4821.firebaseapp.com",
        databaseURL: "https://qbank-f4821-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "qbank-f4821"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const provider = new GoogleAuthProvider();

    // ë¡œê·¸ì¸ í•¸ë“¤ëŸ¬
    window.handleLogin = () => {
        if (auth.currentUser) {
            signOut(auth).then(() => location.reload());
        } else {
            signInWithRedirect(auth, provider);
        }
    };

    getRedirectResult(auth).catch((e) => console.error(e));

    // í•µì‹¬: ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ìµœìƒìœ„ '/' ê²½ë¡œì—ì„œ ì½ê¸°)
    onValue(ref(db, '/'), (snapshot) => {
        const data = snapshot.val();
        const quizListDiv = document.getElementById('quiz-list');
        
        if (!data) {
            quizListDiv.innerHTML = "<p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì´ì¬ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.</p>";
            return;
        }

        let html = "";
        // ìµœìƒìœ„ì˜ ê° í•­ëª©(ê³¼ëª©ëª…) ìˆœíšŒ
        for (let subject in data) {
            // Firebase ê¸°ë³¸ ë…¸ë“œ ì œì™¸ ë¡œì§
            if (typeof data[subject] !== 'object') continue;

            html += `<div class="subject-card">`;
            html += `<h2 class="subject-title">ğŸ“˜ ${subject}</h2>`;
            
            for (let year in data[subject]) {
                html += `<div class="year-section"><strong>ğŸ“… ${year}ë…„</strong><br>`;
                for (let type in data[subject][year]) {
                    const count = data[subject][year][type].length;
                    html += `<button class="quiz-btn" onclick="startQuiz('${subject}', '${year}', '${type}')">
                                ${type} (${count}ë¬¸ì œ)
                             </button>`;
                }
                html += `</div>`;
            }
            html += `</div>`;
        }
        quizListDiv.innerHTML = html;
    });

    window.startQuiz = (s, y, t) => {
        alert(`${s} - ${y}ë…„ ${t} ê¸°ì¶œë¬¸ì œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤! (ê¸°ëŠ¥ êµ¬í˜„ ì¤‘)`);
    };

    onAuthStateChanged(auth, (user) => {
        const btn = document.getElementById('loginBtn');
        const text = document.getElementById('userText');
        if (user) {
            text.innerText = `${user.displayName}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤! `;
            btn.innerText = "ë¡œê·¸ì•„ì›ƒ";
        }
    });
</script>
</body>
</html>